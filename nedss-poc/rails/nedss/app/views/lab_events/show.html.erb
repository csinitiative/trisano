<h1>Show Lab Event</h1>
<fieldset>
<legend>Lab Event</legend>  
<table cellpadding="2">
<tr>
  <td><%= label(:lab_event, :record_number) %></td>
  <td><%= @lab_event.record_number %></td>
  <td><%= label(:lab_event, :event_name) %></td>
  <td><%= @lab_event.event_name %></td>  
</tr>
<tr>
  <td><%= label(:lab_event, :event_onset_date) %></td>
  <td><%= @lab_event.event_onset_date %></td>
  <td><%= label(:lab_event, :disease_id, "Disease") %></td>
  <td><%= @lab_event.disease.disease.disease_name %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :event_type) %></td>
  <td><%= l @lab_event.event_type %></td>
  <td><%= label(:lab_event, :event_status) %></td>
  <td><%= l @lab_event.event_status %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :imported_from) %></td>
  <td><%= l @lab_event.imported_from %></td>
  <td><%= label(:lab_event, :event_case_status) %></td>
  <td><%= l @lab_event.event_case_status %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :outbreak_associated) %></td>
  <td><%= l @lab_event.outbreak_associated %></td>
  <td><%= label(:lab_event, :outbreak_name) %></td>
  <td><%= @lab_event.outbreak_name %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :investigation_LHD_status) %></td>
  <td><%= l @lab_event.investigation_LHD_status %></td>
  <td><%= label(:lab_event, :investigation_started_date) %></td>
  <td><%= @lab_event.investigation_started_date %></td>
  <td><%= label(:lab_event, :investigation_completed_LHD_date) %></td>
  <td><%= @lab_event.investigation_completed_LHD_date %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :review_completed_UDOH_date, "Review completed date") %></td>
  <td><%= @lab_event.review_completed_UDOH_date %></td>
  <td><%= label(:lab_event, :first_reported_PH_date, "First reported date") %></td>
  <td><%= @lab_event.first_reported_PH_date %></td>
  <td><%= label(:lab_event, :results_reported_to_clinician_date) %></td>
  <td><%= @lab_event.results_reported_to_clinician_date %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :disease_onset_date) %></td>
  <td><%= @lab_event.disease.disease_onset_date %></td>
  <td><%= label(:lab_event, :date_diagnosed) %></td>
  <td><%= @lab_event.disease.date_diagnosed %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :hospitalized) %></td>
  <td><%= l @lab_event.disease.hospitalized %></td>
  <td><%= label(:lab_event, :died) %></td>
  <td><%= l @lab_event.disease.died %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :pregnant) %></td>
  <td><%= l @lab_event.disease.pregnant %></td>
  <td><%= label(:lab_event, :pregnancy_due_date) %></td>
  <td><%= @lab_event.disease.pregnancy_due_date %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :specimen_source, "Tested") %></td>
  <td><%= l @lab_event.lab_result.specimen_source %></td>
  <td><%= label(:lab_event, :lab_result_text, "Found") %></td>
  <td><%= @lab_event.lab_result.lab_result_text %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :collection_date) %></td>
  <td><%= @lab_event.lab_result.collection_date %></td>
  <td><%= label(:lab_event, :lab_test_date) %></td>
  <td><%= @lab_event.lab_result.lab_test_date %></td>
  <td><%= label(:lab_event, :tested_at_uphl_yn, "Tested at UPHL lab") %></td>
  <td><%= l @lab_event.lab_result.tested_at_uphl_yn %></td>
</tr>
<tr>
  <td><%= label(:lab_event, :MMWR_year) %></td>
  <td><%= @lab_event.MMWR_year %></td>
  <td><%= label(:lab_event, :MMWR_week) %></td>
  <td><%= @lab_event.MMWR_week %></td>
</tr>
</table>
</fieldset>
<%= link_to 'Edit', edit_lab_event_path(@lab_event) %> |
<%= link_to 'Export to CSV', lab_event_path(@lab_event)+'.csv' %> |
<%= link_to 'Back', lab_events_path %>

<%# Currently makes some gross, simplifying assumptions: %>
<%#  - the primary_entity is always a person: %>
<%#  - the secondary entity is always a hospital: %>
<fieldset>
  <legend>Associations</legend>
  <% if not @lab_event.participations.empty? %>
    <table cellpadding="2">
    <% for participant in @lab_event.participations %>
      <% for entity in [participant.primary_entity, participant.secondary_entity] %>
        <% unless entity.nil? %>
        <tr>
          <% if entity.entity_type == 'person' %>
            <% f_name = fml(" ", entity.current_person.first_name, "") unless entity.current_person.first_name.blank? %>
            <% name = entity.current_person.last_name + f_name.to_s %>
            <td>Person: <%=link_to name, entity_path(entity) %></td>
          <% elsif entity.entity_type == 'place' %> 
            <td>Place: 
            <% if entity.places.last.is_hospital? %> 
              Hospital:
            <% end %>
            <%= entity.places.last.name %></td>
          <% end %>
        </tr>
        <% end %>
      <% end %>
      <% unless participant.hospitals_participation.nil? %>
      <tr>
        <td>Hospitalization data: Admitted: <%= participant.hospitals_participation.admission_date || 'Unknown' %> Discharged: <%= participant.hospitals_participation.discharge_date || 'Unknown' %></td>
      <tr>
      <% end %>
    <% end %>
    </table>
  <% else %>
    <p>No entities are associated with this lab event</p>
  <% end %>
</fieldset>
<%#= link_to 'Add an association', associations_lab_event_path(@lab_event) %>
