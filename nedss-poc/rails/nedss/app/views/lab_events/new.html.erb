<h1>New Confidential Morbidity Report</h1>

<%= error_messages_for :object => [@event, @event.disease, @event.lab_result, @event.participation.entity_primary.person] %>
<%= error_messages_for :object => [@event.participation.entity_primary.entities_location] unless @event.participation.entity_primary.entities_location.nil? %>
<%= error_messages_for :object => [@event.participation.entity_primary.address] unless @event.participation.entity_primary.address.nil? %>
<%= error_messages_for :object => [@event.participation.entity_primary.telephone] unless @event.participation.entity_primary.telephone.nil? %>

<% form_for(@event, :url => cmrs_path, :builder => ExtendedFormBuilder) do |le| %>
  <p>
    <% le.fields_for(:participation, @event.participation, :builder => ExtendedFormBuilder) do |p| %>
      <% p.fields_for(:entity_primary, @event.participation.entity_primary, :builder => ExtendedFormBuilder) do |f| %>
        <%= render :partial => "entities/people/form", :locals => { :f => f, :entity_data => @event.participation.entity_primary } %>
        <%= render :partial => 'locations/form', :locals => { :f => f, :location_data => @event.participation.entity_primary } %>
      <% end %>
   <% end %>
  <%= render :partial => 'form', :locals => { :f => le } %>
  <%= le.submit "Create" %>
  </p>
<% end %>

<%= link_to 'Back', cmrs_path %>
