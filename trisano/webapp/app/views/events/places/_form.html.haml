-# Copyright (C) 2007, 2008, The Collaborative Software Foundation
-# 
-# This file is part of TriSano.
-# 
-# TriSano is free software: you can redistribute it and/or modify it under the 
-# terms of the GNU Affero General Public License as published by the 
-# Free Software Foundation, either version 3 of the License, or 
-# (at your option) any later version.
-# 
-# TriSano is distributed in the hope that it will be useful, but 
-# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or 
-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License 
-# for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along 
-# with TriSano. If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

%fieldset
  %legend 
    Place Information
    %span{:id => 'place_info_hide', :onClick => "Element.hide('place_form'); Element.hide('place_info_hide'); Element.show('place_info_show'); return false;"}
      [Hide]
    %span{:id => 'place_info_show', :onClick => "Element.show('place_form'); Element.hide('place_info_show'); Element.show('place_info_hide'); return false;", :style => "display: none;"}
      [Show]
  %div{:id => 'place_form'}
    =error_messages_for :object => entity_data.place
    -f.fields_for(:active_primary_entity, @event.active_place.primary_entity, :builder => ExtendedFormBuilder) do |current_patient|
      =render :partial => 'events/places/name_form', :locals => {:f => f, :fb_form => current_patient, :event => event, :entity_data => entity_data}

      -if entity_data.address.nil?
        =render :partial => 'events/people/address_form', :locals => {:f => f, :fb_form => current_patient, :event => event, :entity_data => entity_data}
      -else
        =render :partial => 'events/places/address_show', :locals => { :address => entity_data.address, :current_place => current_patient}

      -# Note, there should only ever be one record in telephone_entities_locations
      -if entity_data.telephone_entities_locations.empty? || entity_data.telephone_entities_locations.all? { |phone| phone.new_record? }
        =render :partial => 'events/people/phones_form', :locals => {:f => f, :fb_form => current_patient, :event => event, :entity_data => entity_data, :namespace => 'active_place'}        
      -else
        =render :partial => 'events/people/phones_show', :locals => {:entity_data => entity_data}
