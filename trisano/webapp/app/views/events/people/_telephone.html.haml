-# Copyright (C) 2007, 2008, The Collaborative Software Foundation
-#
-# This file is part of TriSano.
-#
-# TriSano is free software: you can redistribute it and/or modify it under the terms of the
-# GNU Affero General Public License as published by the Free Software Foundation, either 
-# version 3 of the License, or (at your option) any later version.
-#
-# TriSano is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
-# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
-# See the GNU Affero General Public License for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along with TriSano. 
-# If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

.phone
  - _phone = telephone.location.telephones[0]
  - new_or_existing = new_or_existing?(telephone)
  - prefix = event_prefix_for_multi_models(new_or_existing, "_telephone_attributes", namespace) + "[]"

  = error_messages_for :object => _phone

  - fields_for prefix, telephone, :builder => ExtendedFormBuilder do |telephone_form|
    - core_element :entity_location_type_id, telephone_form, :horiz do
      = telephone_form.label(:entity_location_type_id, "Phone type")
      = telephone_form.dropdown_code_field(:entity_location_type_id, 'telephonelocationtype', {}, {})

  - _phone.id = telephone.id

  - fields_for prefix, _phone, :builder => ExtendedFormBuilder do |telephone_form|
    - core_element :area_code, telephone_form, :horiz do
      = telephone_form.label(:area_code)
      = telephone_form.core_text_field(:area_code, {:size => 3, :maxlength => 3, :class => 'autotab'})
    - core_element :phone_number, telephone_form, :horiz do
      = telephone_form.label(:phone_number)
      = telephone_form.core_text_field(:phone_number, {:size => 8})
    - core_element :extension, telephone_form, :horiz do
      = telephone_form.label(:extension)
      = telephone_form.core_text_field(:extension, {:size => 6})
    %fieldset.vert
      - core_element :email_address, telephone_form, :horiz do
        = telephone_form.label(:email_address)
        = telephone_form.core_text_field(:email_address, {})
      %span.horiz
        = telephone_form.label '&nbsp;'
        = link_to_function image_tag("delete.png", :border => 0), "$(this).up('.phone').remove()"
  %hr
