-# Copyright (C) 2007, 2008, The Collaborative Software Foundation
-# 
-# This file is part of TriSano.
-# 
-# TriSano is free software: you can redistribute it and/or modify it under the 
-# terms of the GNU Affero General Public License as published by the 
-# Free Software Foundation, either version 3 of the License, or 
-# (at your option) any later version.
-# 
-# TriSano is distributed in the hope that it will be useful, but 
-# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or 
-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License 
-# for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along 
-# with TriSano. If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

- unless entity_data.address_entities_locations.empty?
  - l = entity_data.address_entities_locations.last.location; a = l.current_address;

- event_form.fields_for(:active_patient, @event.active_patient.primary_entity, :builder => ExtendedFormBuilder) do |active_patient_form|
  - active_patient_form.fields_for(:active_primary_entity, @event.active_patient.primary_entity, :builder => ExtendedFormBuilder) do |primary_form|
    - primary_form.fields_for(:person, entity_data.person, :builder => ExtendedFormBuilder) do |person_form|
    
      = render :partial => 'events/people/name_print.html.haml', :locals => {:person => entity_data.person, :person_form => person_form}
      = render :partial => 'events/people/address_print.html.haml', :locals => {:location => l, :address => a, :current_patient => primary_form}
      = render :partial => 'events/people/age_print.html.haml', :locals => {:person => entity_data.person, :person_form => person_form}
      = render :partial => 'events/people/phones_print.html.haml', :locals => {:entity_data => entity_data}
      = render :partial => 'events/people/demographics_print.html.haml', :locals => {:entity_data => entity_data, :person => entity_data.person, :person_form => person_form}


