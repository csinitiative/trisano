-# Copyright (C) 2007, 2008, The Collaborative Software Foundation
-#
-# This file is part of TriSano.
-#
-# TriSano is free software: you can redistribute it and/or modify it under the terms of the
-# GNU Affero General Public License as published by the Free Software Foundation, either 
-# version 3 of the License, or (at your option) any later version.
-#
-# TriSano is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
-# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
-# See the GNU Affero General Public License for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along with TriSano. 
-# If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

%span.section-header
  Reporting Information

- if @event.active_reporting_agency.nil?
  - fb_part = Participation.new
  - fb_entity = Entity.new
  - agency_data = Place.new
- else
  - fb_part = @event.active_reporting_agency
  - fb_entity = @event.active_reporting_agency.secondary_entity
  - agency_data = @event.active_reporting_agency.secondary_entity.place_temp

- event_form.fields_for(:active_reporting_agency, fb_part, :builder => ExtendedFormBuilder) do |agency_form|
  - agency_form.fields_for(:active_secondary_entity, fb_entity, :builder => ExtendedFormBuilder) do |entity_form|
    - entity_form.fields_for(:place, agency_data, :builder => ExtendedFormBuilder) do |place_form|
      - core_element_show :name, place_form, :horiz do
        %span.print-label Agency name:
        %span.print-value= agency_data.name

- reporter_name = Person.new
- reporter_ent_loc = EntitiesLocation.new
- reporter_phone = Telephone.new

- fb_part = Participation.new
- fb_entity = Entity.new

- if !@event.reporter.nil?
  - fb_part = @event.reporter
  - fb_entity = @event.reporter.secondary_entity
  - if !@event.reporter.secondary_entity.person_temp.nil?
    - reporter_name = @event.reporter.secondary_entity.person_temp
  - if !@event.reporter.secondary_entity.telephone_entities_locations.empty?
    - reporter_ent_loc = @event.reporter.secondary_entity.telephone_entities_locations.last
    - reporter_phone = reporter_ent_loc.location.telephones.last

- event_form.fields_for(:active_reporter, fb_part, :builder => ExtendedFormBuilder) do |participant_fields|
  - participant_fields.fields_for(:active_secondary_entity, fb_entity, :builder => ExtendedFormBuilder) do |agency_fields|
    - agency_fields.fields_for(:person, reporter_name, :builder => ExtendedFormBuilder) do |reporter_fields|

      - core_element_show :first_name, reporter_fields, :horiz do
        %span.print-label First name:
        %span.print-value= reporter_name.first_name
      - core_element_show :last_name, reporter_fields, :vert do
        %span.print-label Last name:
        %span.print-value= reporter_name.last_name

    - agency_fields.fields_for(:telephone_entities_location, reporter_ent_loc, :builder => ExtendedFormBuilder) do |el|
      - core_element_show :entity_location_type_id, el, :horiz do
        %span.print-label Phone type:
        %span.print-value= l reporter_ent_loc.entity_location_type

    - agency_fields.fields_for(:telephone, reporter_phone, :builder => ExtendedFormBuilder) do |phone_fields|
      - core_element_show :area_code, phone_fields, :horiz do
        %span.print-label Area code:
        %span.print-value= reporter_phone.area_code
      - core_element_show :phone_number, phone_fields, :horiz do
        %span.print-label Phone number:
        %span.print-value= reporter_phone.phone_number
      - core_element_show :extension, phone_fields, :horiz do
        %span.print-label Extension:
        %span.print-value= reporter_phone.extension

    - core_element_show :results_reported_to_clinician_date, event_form, :horiz do
      %span.print-label Results reported to clinician date:
      %span.print-value= h(@event.results_reported_to_clinician_date) || '&nbsp;'
    - core_element_show :first_reported_PH_date, event_form, :vert do
      %span.print-label Date first reported to public health:
      %span.print-value= h(@event.first_reported_PH_date)
