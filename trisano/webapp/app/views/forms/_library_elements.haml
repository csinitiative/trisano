-# Copyright (C) 2007, 2008, The Collaborative Software Foundation
-#
-# This file is part of TriSano.
-#
-# TriSano is free software: you can redistribute it and/or modify it under the terms of the
-# GNU Affero General Public License as published by the Free Software Foundation, either 
-# version 3 of the License, or (at your option) any later version.
-#
-# TriSano is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
-# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
-# See the GNU Affero General Public License for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along with TriSano. 
-# If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

- replace_element, replace_partial = replacement_elements(@reference_element)

-# Default group
- if direction == :to_library
  - q_string = link_to_remote("No Group", :update => "library-element-list-#{@reference_element.id}", :complete => visual_effect(:highlight, "library-element-list-#{@reference_element.id}"), :url => {:controller => "forms", :action => "to_library", :group_element_id => "root", :reference_element_id => @reference_element.id})
- else
  - q_string = "No Group"

%li{:id => "lib_group_item_root", :class => "lib-question-item"}=q_string

-# Questions not in a group (de facto children of "no group")
%ul
  - for form_element in @library_elements
    - next if form_element.is_a? GroupElement

    - if direction == :to_library
      - q_string = form_element.question.question_text
    -else
      - q_string = link_to_remote(form_element.question.question_text, :update => "#{replace_element}", :complete => visual_effect(:highlight, "#{replace_element}"), :url => {:controller => "forms", :action => "from_library", :reference_element_id => @reference_element.id, :lib_element_id => form_element.id})

    - q_string += "&nbsp;&nbsp;<small>" + form_element.question.data_type_before_type_cast.humanize + "</small>"
    - form_element.pre_order_walk do |element|
      - q_string += "<br />&nbsp;&nbsp;<em><small>Value Set:&nbsp;&nbsp;" + element.name + "</small></em>: " if element.is_a? ValueSetElement
      - q_string += fml("<em><small>", element.name, "</small></em>&nbsp;&nbsp;") if element.is_a? ValueElement

    %li{:id => "lib_question_item_#{form_element.id}", :class => "lib-question-item"}=q_string
  
-# All real groups
- for form_element in @library_elements
  - next if form_element.is_a? QuestionElement

  - if direction == :to_library
    - q_string = link_to_remote("Add question to: #{form_element.name}", :update => "library-element-list-#{@reference_element.id}", :complete => visual_effect(:highlight, "library-element-list-#{@reference_element.id}"), :url => {:controller => "forms", :action => "to_library", :group_element_id => form_element.id, :reference_element_id => @reference_element.id})
  - else
    - q_string = link_to_remote("Click to add all questions in group: #{form_element.name}", :update => "#{replace_element}", :complete => visual_effect(:highlight, "#{replace_element}"), :url => {:controller => "forms", :action => "from_library", :reference_element_id => @reference_element.id, :lib_element_id => form_element.id})
  %li{:id => "lib_group_item_#{form_element.id}", :class => "lib-question-item"}=q_string

  -# children of this group, i.e. questions
  %ul
    - for form_element in form_element.children

      - if direction == :to_library
        - q_string = form_element.question.question_text
      -else
        - q_string = link_to_remote(form_element.question.question_text, :update => "#{replace_element}", :complete => visual_effect(:highlight, "#{replace_element}"), :url => {:controller => "forms", :action => "from_library", :reference_element_id => @reference_element.id, :lib_element_id => form_element.id})

      - q_string += "&nbsp;&nbsp;<small>" + form_element.question.data_type_before_type_cast.humanize + "</small>"
      - form_element.pre_order_walk do |element|
        - q_string += "<br />&nbsp;&nbsp;<em><small>Value Set:&nbsp;&nbsp;" + element.name + "</small></em>: " if element.is_a? ValueSetElement
        - q_string += fml("<em><small>", element.name, "</small></em>&nbsp;&nbsp;") if element.is_a? ValueElement

      %li{:id => "lib_question_item_#{form_element.id}", :class => "lib-question-item"}=q_string
