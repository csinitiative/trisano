<!--
Copyright (C) 2007, 2008, The Collaborative Software Foundation

This file is part of TriSano.

TriSano is free software: you can redistribute it and/or modify it under the 
terms of the GNU Affero General Public License as published by the 
Free Software Foundation, either version 3 of the License, or 
(at your option) any later version.

TriSano is distributed in the hope that it will be useful, but 
WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or 
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License 
for more details.

You should have received a copy of the GNU Affero General Public License along 
with TriSano. If not, see http://www.gnu.org/licenses/agpl-3.0.txt.
-->

<% e = entity_data %>
<% p = entity_data.person %>

<% unless entity_data.entities_location.nil? %>
  <% l = entity_data.primary_entities_location.location; a = l.current_address; %>
<% end %>

<% unless entity_data.telephone_entities_location.nil? %>
  <% telephone_location = entity_data.primary_phone_entities_location.location; telephone = telephone_location.current_phone %>
<% end %>

<% event_form.fields_for(:active_patient, @event.active_patient, :builder => ExtendedFormBuilder) do |patient_fields| %>
  <% patient_fields.fields_for(:active_primary_entity, @event.active_patient.active_primary_entity, :builder => ExtendedFormBuilder) do |current_patient| %>
    <% current_patient.fields_for(:person, p, :builder => ExtendedFormBuilder) do |person_form| %>

      <fieldset>
        <legend> Person Information</legend>
        <%= render :partial => 'entities/people/name', :locals => {:person => p, :person_form => person_form} %>
        <%= render :partial => 'entities/people/address', :locals => {:location => l, :address => a, :current_patient => current_patient} %>
        <%= render :partial => 'entities/people/age', :locals => {:person => p, :person_form => person_form} %>
        <%= render :partial => 'entities/people/phones', :locals => {:entity_data => entity_data} %>
        <%= render :partial => 'entities/people/demographics', :locals => {:entity_data => entity_data, :person => p, :person_form => person_form} %>
      </fieldset>

    <% end %>
  <% end %>
<% end %>
