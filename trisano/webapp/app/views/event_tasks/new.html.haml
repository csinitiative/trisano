-# Copyright (C) 2007, 2008, 2009 The Collaborative Software Foundation
-#
-# This file is part of TriSano.
-#
-# TriSano is free software: you can redistribute it and/or modify it under the terms of the
-# GNU Affero General Public License as published by the Free Software Foundation, either 
-# version 3 of the License, or (at your option) any later version.
-#
-# TriSano is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
-# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
-# See the GNU Affero General Public License for more details.
-# 
-# You should have received a copy of the GNU Affero General Public License along with TriSano. 
-# If not, see http://www.gnu.org/licenses/agpl-3.0.txt.

- content_for :title do
  Add Event Task

- content_for :name do
  = render(:partial => 'events/basic_event_info', :locals => { :event => @event })

#new-task-form

  %h2
    New Task

  = error_messages_for :task

  - form_for(@task, :url => event_tasks_path(@event)) do |f|

    = f.hidden_field :event_id

    %span{ :class => "vert" }
      = f.label(:name)
      = f.text_field(:name, :size => 20)

    %span{ :class => "vert" }
      = f.label(:notes, "Notes")
      = f.text_area(:notes, :rows => 5, :cols => 50)

    %span{ :class => "vert" }
      = f.label(:category)
      = f.collection_select(:category_id, ExternalCode.find_all_by_code_name('task_category', :order => 'sort_order'), :id, :code_description, {:include_blank => true})

    %span{ :class => "vert" }
      = f.label(:priority)
      = f.select(:priority, [["Low", "low"], ["Medium", "medium"], ["High", "high"]], {:include_blank => true})

    %span{ :class => "vert" }
      = f.label(:due_date)
      = f.calendar_date_select(:due_date, {:year_range => 0.years.from_now...100.years.from_now})

    - if User.current_user.is_entitled_to?(:assign_task_to_user)
      - assignees = User.task_assignees_for_jurisdictions(User.current_user.jurisdictions_for_privilege(:assign_task_to_user))
      - unless assignees.empty?
        %span{ :class => "vert" }
          = f.label(:user)
          = f.collection_select(:user_id, User.task_assignees_for_jurisdictions(User.current_user.jurisdictions_for_privilege(:assign_task_to_user)), :id, :best_name, {:include_blank => true})

    %br{ :clear => 'all' }
    %br
    = f.submit "Create"

%br

%hr

#existing-tasks
  %h2
    Existing Tasks
  = render(:partial => 'event_tasks/list', :locals => { :event => @event })